name: Build
description: Run build for specified package
inputs:
  package:
    description: The package to build.
    type: string
    required: true
  node-version:
    description: The version of node to use.
    type: string
    default: 20.x
    required: false

runs:
  using: composite
  steps:
    - uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}

    - name: Install Package
      run: npm install -w @poppy-ui/${{ inputs.package }}
      shell: bash

    - name: Install Core
      if: inputs.package != 'core'
      run: npm install @poppy-ui/core @poppy-ui/docs -w @poppy-ui/${{ inputs.package }}
      shell: bash

    - name: Build
      run: npm run build -w @poppy-ui/${{ inputs.package }} --if-present
      shell: bash

    - name: Pack
      run: npm pack -w @poppy-ui/${{ inputs.package }}
      shell: bash

    - name: Rename tarball
      run: |
        PKG=$(ls poppy-ui-${{ inputs.package }}-*.tgz)
        mv $PKG poppy-ui-${{ inputs.package }}.tgz
      shell: bash

    - uses: actions/upload-artifact@v4
      with:
        name: ${{ inputs.package }}-${{ inputs.node-version }}
        path: ./poppy-ui-${{ inputs.package }}-${{ inputs.node-version }}.tgz
